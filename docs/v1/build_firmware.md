# ファームウェアをビルドする

- [環境構築](#環境構築)
  - [ファームウェアのリポジトリをクローンする](#ファームウェアのリポジトリをクローンする)
- [ビルドする](#ビルドする)
  - [uf2ファイルを生成する](#uf2ファイルを生成する)
- [生成したファームウェアを書き込む](#生成したファームウェアを書き込む)

## 環境構築

導入手順はQMKとほとんど同様です。基本的にはQMKの導入手順にしたがって必要ソフトをインストールしてください。


### ファームウェアのリポジトリをクローンする

- QMK公式のqmk_firmwareリポジトリとは別にBLE Micro Pro用のリポジトリをクローンする必要があります。
- ここでは `qmk_firmware_bmp_vial` という名前でクローンします。

``` 
git clone --depth 1 -b dev/ble_micro_pro https://github.com/sekigon-gonnoc/vial-qmk.git qmk_firmware_bmp_vial
```

uf2ではなくnrfutilを使って書き込む場合、追加でnrfutilをインストールします。

```
pip install nrfutil --user
```

## ビルドする

### uf2ファイルを生成する

以下のコマンドでuf2ファイルが生成されます。

```
make ble_micro_pro:vial:uf2
```

## 生成したファームウェアを書き込む

ブートローダを起動してください。ブートローダの起動は以下のいずれかにより行えます。

- リセットボタンを押しながらUSBケーブルで接続する
- [CLI](cli.md)からdfuコマンドを発行する
- リセットボタンを長押しする

ブートローダを起動すると外部メディアとして認識されます。外部メディアは `BLEMICROPRO` という名前です。
この外部メディアに生成されたuf2ファイルをコピーすることでファームウェアがアップデートされます。
